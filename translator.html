<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translator API - Chrome AI Shell</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: linear-gradient(-45deg, #0f172a, #1e293b, #334155, #475569, #64748b, #475569);
            --bg-glass: rgba(15, 23, 42, 0.8);
            --border-glass: rgba(71, 85, 105, 0.3);
            --text-primary: #ffffff;
            --text-secondary: #e2e8f0;
        }

        .gradient-bg {
            background: var(--bg-primary);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        .glass-morphism {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-glass);
        }

        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-ready { background-color: #10b981; }
        .status-loading { background-color: #f59e0b; animation: pulse 2s infinite; }
        .status-unavailable { background-color: #ef4444; }

        .translation-box {
            min-height: 200px;
            resize: vertical;
        }

        .language-selector {
            position: relative;
        }

        .language-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
        }

        .language-dropdown.active {
            display: block;
        }

        .stream-output {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <!-- Header -->
    <header class="glass-morphism shadow-lg">
        <div class="w-full px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <button onclick="window.history.back()" class="glass-morphism rounded-lg p-2 hover:bg-white hover:bg-opacity-20 transition-all">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-globe text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Translation API</h1>
                        <p class="text-sm text-gray-200">Chrome Built-in AI Translation Service</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center glass-morphism rounded-lg px-3 py-2">
                        <span id="api-status" class="status-indicator status-loading"></span>
                        <span id="status-text" class="text-sm">Checking...</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="w-full py-8">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- API Status Alert -->
            <div id="status-alert" class="hidden mb-6 glass-morphism rounded-lg p-4">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-yellow-300 mr-3"></i>
                    <div>
                        <h3 class="font-semibold text-white">API Not Available</h3>
                        <p class="text-gray-200 text-sm" id="status-message">The Translation API is not available in this browser.</p>
                    </div>
                </div>
            </div>

            <!-- Translation Interface -->
            <div class="glass-morphism rounded-2xl p-6 mb-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    
                    <!-- Input Section -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-white">Source Text</h3>
                            <div class="language-selector">
                                <button id="source-lang-btn" class="glass-morphism rounded-lg px-4 py-2 text-sm text-white hover:bg-white hover:bg-opacity-20 transition-all flex items-center">
                                    <span id="source-lang-text">Auto-detect</span>
                                    <i class="fas fa-chevron-down ml-2"></i>
                                </button>
                                <div id="source-lang-dropdown" class="language-dropdown glass-morphism rounded-lg mt-1">
                                    <!-- Language options will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <textarea 
                            id="source-text" 
                            class="translation-box w-full p-4 bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg text-white placeholder-gray-400 resize-vertical"
                            placeholder="Enter text to translate..."
                            rows="8"
                        ></textarea>

                        <div class="flex items-center justify-between">
                            <div class="text-xs text-gray-400">
                                <span id="char-count">0</span> characters
                            </div>
                            <div class="flex space-x-2">
                                <button id="clear-btn" class="px-4 py-2 text-sm text-gray-300 hover:text-white transition-colors">
                                    <i class="fas fa-trash mr-1"></i> Clear
                                </button>
                                <button id="paste-btn" class="px-4 py-2 text-sm text-blue-300 hover:text-white transition-colors">
                                    <i class="fas fa-paste mr-1"></i> Paste
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Output Section -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-white">Translation</h3>
                            <div class="language-selector">
                                <button id="target-lang-btn" class="glass-morphism rounded-lg px-4 py-2 text-sm text-white hover:bg-white hover:bg-opacity-20 transition-all flex items-center">
                                    <span id="target-lang-text">Select Language</span>
                                    <i class="fas fa-chevron-down ml-2"></i>
                                </button>
                                <div id="target-lang-dropdown" class="language-dropdown glass-morphism rounded-lg mt-1">
                                    <!-- Language options will be populated here -->
                                </div>
                            </div>
                        </div>

                        <div class="translation-box w-full p-4 bg-gray-900 bg-opacity-50 border border-gray-600 rounded-lg min-h-[200px] relative">
                            <div id="translation-output" class="stream-output text-white"></div>
                            <div id="translation-placeholder" class="text-gray-500">Translation will appear here...</div>
                            <div id="loading-indicator" class="hidden absolute inset-0 flex items-center justify-center">
                                <div class="flex items-center space-x-2">
                                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-300"></div>
                                    <span class="text-purple-300">Translating...</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <div class="text-xs text-gray-400" id="translation-info">
                            </div>
                            <div class="flex space-x-2">
                                <button id="copy-btn" class="px-4 py-2 text-sm text-green-300 hover:text-white transition-colors disabled:opacity-50" disabled>
                                    <i class="fas fa-copy mr-1"></i> Copy
                                </button>
                                <button id="speak-btn" class="px-4 py-2 text-sm text-blue-300 hover:text-white transition-colors disabled:opacity-50" disabled>
                                    <i class="fas fa-volume-up mr-1"></i> Speak
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Translation Controls -->
                <div class="flex items-center justify-center mt-6 space-x-4">
                    <button id="swap-languages" class="glass-morphism rounded-lg p-3 hover:bg-white hover:bg-opacity-20 transition-all" title="Swap languages">
                        <i class="fas fa-exchange-alt text-purple-300"></i>
                    </button>
                    <button id="translate-btn" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-lg hover:shadow-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fas fa-language mr-2"></i>
                        <span id="translate-btn-text">Translate</span>
                    </button>
                </div>
            </div>

            <!-- Features and Tips -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Features -->
                <div class="glass-morphism rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-star text-yellow-300 mr-3"></i>
                        Features
                    </h3>
                    <ul class="space-y-3 text-gray-200">
                        <li class="flex items-center">
                            <i class="fas fa-check-circle text-green-300 mr-3"></i>
                            Real-time translation
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check-circle text-green-300 mr-3"></i>
                            100+ language pairs supported
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check-circle text-green-300 mr-3"></i>
                            Privacy-first (local processing)
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check-circle text-green-300 mr-3"></i>
                            Context-aware translations
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check-circle text-green-300 mr-3"></i>
                            Streaming output support
                        </li>
                    </ul>
                </div>

                <!-- Tips -->
                <div class="glass-morphism rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-lightbulb text-blue-300 mr-3"></i>
                        Usage Tips
                    </h3>
                    <ul class="space-y-3 text-gray-200 text-sm">
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-purple-300 mr-2 mt-1"></i>
                            <span>For best results, provide complete sentences rather than individual words</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-purple-300 mr-2 mt-1"></i>
                            <span>The API works best with common language pairs</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-purple-300 mr-2 mt-1"></i>
                            <span>Context matters - longer texts generally translate better</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-purple-300 mr-2 mt-1"></i>
                            <span>All processing happens locally in your browser</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <script>
        class TranslatorApp {
            constructor() {
                this.translator = null;
                this.sourceLanguage = 'auto';
                this.targetLanguage = null;
                this.isTranslating = false;
                
                // Common language pairs
                this.languages = {
                    'auto': 'Auto-detect',
                    'en': 'English',
                    'es': 'Spanish',
                    'fr': 'French',
                    'de': 'German',
                    'it': 'Italian',
                    'pt': 'Portuguese',
                    'ru': 'Russian',
                    'ja': 'Japanese',
                    'ko': 'Korean',
                    'zh': 'Chinese',
                    'ar': 'Arabic',
                    'hi': 'Hindi',
                    'tr': 'Turkish',
                    'pl': 'Polish',
                    'nl': 'Dutch',
                    'sv': 'Swedish',
                    'da': 'Danish',
                    'no': 'Norwegian',
                    'fi': 'Finnish'
                };
                
                this.init();
            }
            
            async init() {
                await this.checkAPIAvailability();
                this.setupEventListeners();
                this.populateLanguageDropdowns();
                this.updateUI();
            }
            
            async checkAPIAvailability() {
                const statusIndicator = document.getElementById('api-status');
                const statusText = document.getElementById('status-text');
                const statusAlert = document.getElementById('status-alert');
                const statusMessage = document.getElementById('status-message');
                
                try {
                    if (!('Translator' in self)) {
                        throw new Error('Translator API not supported');
                    }
                    
                    // Check availability with a sample language pair
                    const availability = await Translator.availability({
                        sourceLanguage: 'en',
                        targetLanguage: 'es'
                    });
                    
                    if (availability === 'unavailable') {
                        statusIndicator.className = 'status-indicator status-unavailable';
                        statusText.textContent = 'Unavailable';
                        statusAlert.classList.remove('hidden');
                        statusMessage.textContent = 'The Translation API is not available. Please ensure you\'re using Chrome 138+ with built-in AI APIs enabled.';
                        return;
                    }
                    
                    statusIndicator.className = 'status-indicator status-ready';
                    statusText.textContent = 'Ready';
                    
                } catch (error) {
                    console.error('Translation API availability check failed:', error);
                    statusIndicator.className = 'status-indicator status-unavailable';
                    statusText.textContent = 'Unavailable';
                    statusAlert.classList.remove('hidden');
                    statusMessage.textContent = 'Translation API is not available in this browser. Please use Chrome 138+ with built-in AI features enabled.';
                }
            }
            
            setupEventListeners() {
                const sourceText = document.getElementById('source-text');
                const translateBtn = document.getElementById('translate-btn');
                const clearBtn = document.getElementById('clear-btn');
                const pasteBtn = document.getElementById('paste-btn');
                const copyBtn = document.getElementById('copy-btn');
                const speakBtn = document.getElementById('speak-btn');
                const swapBtn = document.getElementById('swap-languages');
                
                // Text input events
                sourceText.addEventListener('input', () => {
                    this.updateCharCount();
                    this.updateTranslateButton();
                });
                
                sourceText.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        this.translate();
                    }
                });
                
                // Button events
                translateBtn.addEventListener('click', () => this.translate());
                clearBtn.addEventListener('click', () => this.clearText());
                pasteBtn.addEventListener('click', () => this.pasteText());
                copyBtn.addEventListener('click', () => this.copyTranslation());
                speakBtn.addEventListener('click', () => this.speakTranslation());
                swapBtn.addEventListener('click', () => this.swapLanguages());
                
                // Language selector events
                this.setupLanguageSelectors();
            }
            
            setupLanguageSelectors() {
                const sourceLangBtn = document.getElementById('source-lang-btn');
                const targetLangBtn = document.getElementById('target-lang-btn');
                const sourceLangDropdown = document.getElementById('source-lang-dropdown');
                const targetLangDropdown = document.getElementById('target-lang-dropdown');
                
                sourceLangBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    sourceLangDropdown.classList.toggle('active');
                    targetLangDropdown.classList.remove('active');
                });
                
                targetLangBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    targetLangDropdown.classList.toggle('active');
                    sourceLangDropdown.classList.remove('active');
                });
                
                document.addEventListener('click', () => {
                    sourceLangDropdown.classList.remove('active');
                    targetLangDropdown.classList.remove('active');
                });
            }
            
            populateLanguageDropdowns() {
                const sourceLangDropdown = document.getElementById('source-lang-dropdown');
                const targetLangDropdown = document.getElementById('target-lang-dropdown');
                
                // Source languages (including auto-detect)
                Object.entries(this.languages).forEach(([code, name]) => {
                    const option = document.createElement('div');
                    option.className = 'px-4 py-2 hover:bg-white hover:bg-opacity-20 cursor-pointer text-white text-sm';
                    option.textContent = name;
                    option.addEventListener('click', () => {
                        this.sourceLanguage = code;
                        document.getElementById('source-lang-text').textContent = name;
                        sourceLangDropdown.classList.remove('active');
                        this.updateTranslateButton();
                    });
                    sourceLangDropdown.appendChild(option);
                });
                
                // Target languages (excluding auto-detect)
                Object.entries(this.languages).forEach(([code, name]) => {
                    if (code === 'auto') return;
                    
                    const option = document.createElement('div');
                    option.className = 'px-4 py-2 hover:bg-white hover:bg-opacity-20 cursor-pointer text-white text-sm';
                    option.textContent = name;
                    option.addEventListener('click', () => {
                        this.targetLanguage = code;
                        document.getElementById('target-lang-text').textContent = name;
                        targetLangDropdown.classList.remove('active');
                        this.updateTranslateButton();
                    });
                    targetLangDropdown.appendChild(option);
                });
            }
            
            updateCharCount() {
                const sourceText = document.getElementById('source-text');
                const charCount = document.getElementById('char-count');
                charCount.textContent = sourceText.value.length;
            }
            
            updateTranslateButton() {
                const sourceText = document.getElementById('source-text');
                const translateBtn = document.getElementById('translate-btn');
                
                const hasText = sourceText.value.trim().length > 0;
                const hasTargetLanguage = this.targetLanguage !== null;
                const apiAvailable = document.getElementById('api-status').classList.contains('status-ready');
                
                translateBtn.disabled = !(hasText && hasTargetLanguage && apiAvailable && !this.isTranslating);
            }
            
            async translate() {
                if (this.isTranslating) return;
                
                const sourceText = document.getElementById('source-text').value.trim();
                if (!sourceText) return;
                
                this.isTranslating = true;
                this.updateUI();
                
                try {
                    // Create translator if needed
                    if (!this.translator || this.translator.sourceLanguage !== this.sourceLanguage || this.translator.targetLanguage !== this.targetLanguage) {
                        const translatorOptions = {
                            sourceLanguage: this.sourceLanguage === 'auto' ? 'en' : this.sourceLanguage, // Fallback for auto-detect
                            targetLanguage: this.targetLanguage
                        };
                        
                        this.translator = await Translator.create(translatorOptions);
                    }
                    
                    // Clear previous output
                    const output = document.getElementById('translation-output');
                    const placeholder = document.getElementById('translation-placeholder');
                    const loading = document.getElementById('loading-indicator');
                    
                    placeholder.style.display = 'none';
                    loading.classList.remove('hidden');
                    output.textContent = '';
                    
                    // Use streaming translation for better UX
                    const stream = this.translator.translateStreaming(sourceText);
                    
                    loading.classList.add('hidden');
                    
                    for await (const chunk of stream) {
                        output.textContent += chunk;
                    }
                    
                    this.updateTranslationInfo();
                    this.enableTranslationActions();
                    
                } catch (error) {
                    console.error('Translation failed:', error);
                    this.showError('Translation failed: ' + error.message);
                } finally {
                    this.isTranslating = false;
                    this.updateUI();
                }
            }
            
            updateTranslationInfo() {
                const info = document.getElementById('translation-info');
                const langFrom = this.languages[this.sourceLanguage] || this.sourceLanguage;
                const langTo = this.languages[this.targetLanguage] || this.targetLanguage;
                info.textContent = `Translated from ${langFrom} to ${langTo}`;
            }
            
            enableTranslationActions() {
                document.getElementById('copy-btn').disabled = false;
                document.getElementById('speak-btn').disabled = false;
            }
            
            clearText() {
                document.getElementById('source-text').value = '';
                document.getElementById('translation-output').textContent = '';
                document.getElementById('translation-placeholder').style.display = 'block';
                document.getElementById('translation-info').textContent = '';
                document.getElementById('copy-btn').disabled = true;
                document.getElementById('speak-btn').disabled = true;
                this.updateCharCount();
                this.updateTranslateButton();
            }
            
            async pasteText() {
                try {
                    const text = await navigator.clipboard.readText();
                    const sourceText = document.getElementById('source-text');
                    sourceText.value = text;
                    this.updateCharCount();
                    this.updateTranslateButton();
                } catch (error) {
                    console.error('Failed to paste text:', error);
                }
            }
            
            async copyTranslation() {
                const output = document.getElementById('translation-output');
                try {
                    await navigator.clipboard.writeText(output.textContent);
                    this.showNotification('Translation copied to clipboard', 'success');
                } catch (error) {
                    console.error('Failed to copy text:', error);
                    this.showNotification('Failed to copy text', 'error');
                }
            }
            
            speakTranslation() {
                const output = document.getElementById('translation-output');
                const text = output.textContent;
                
                if (text && 'speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = this.targetLanguage || 'en';
                    speechSynthesis.speak(utterance);
                } else {
                    this.showNotification('Speech synthesis not available', 'error');
                }
            }
            
            swapLanguages() {
                if (this.sourceLanguage === 'auto') return; // Can't swap from auto-detect
                
                const sourceText = document.getElementById('source-text');
                const output = document.getElementById('translation-output');
                
                // Swap languages
                const tempLang = this.sourceLanguage;
                this.sourceLanguage = this.targetLanguage;
                this.targetLanguage = tempLang;
                
                // Swap text
                const tempText = sourceText.value;
                sourceText.value = output.textContent;
                output.textContent = tempText;
                
                // Update UI
                document.getElementById('source-lang-text').textContent = this.languages[this.sourceLanguage];
                document.getElementById('target-lang-text').textContent = this.languages[this.targetLanguage];
                
                this.updateCharCount();
                this.updateTranslateButton();
                
                // Reset translator
                this.translator = null;
            }
            
            updateUI() {
                const translateBtn = document.getElementById('translate-btn');
                const translateBtnText = document.getElementById('translate-btn-text');
                const loading = document.getElementById('loading-indicator');
                
                if (this.isTranslating) {
                    translateBtnText.textContent = 'Translating...';
                    loading.classList.remove('hidden');
                } else {
                    translateBtnText.textContent = 'Translate';
                    loading.classList.add('hidden');
                }
                
                this.updateTranslateButton();
            }
            
            showError(message) {
                const output = document.getElementById('translation-output');
                const loading = document.getElementById('loading-indicator');
                
                loading.classList.add('hidden');
                output.innerHTML = `<div class="text-red-300"><i class="fas fa-exclamation-triangle mr-2"></i>${message}</div>`;
            }
            
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full`;
                
                const bgColor = type === 'success' ? 'bg-green-500' : 
                               type === 'error' ? 'bg-red-500' : 'bg-blue-500';
                
                notification.className += ` ${bgColor} text-white`;
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-info-circle mr-2"></i>
                        <span>${message}</span>
                    </div>
                `;

                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);

                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new TranslatorApp();
        });
    </script>
</body>
</html>